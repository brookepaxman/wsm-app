{% load static %}

<link rel="stylesheet" type="text/css" href="{% static '/chartjs/dist/Chart.min.css' %}">
<link rel="stylesheet" type="text/css" href="{% static '/admin/css/bootstrap.css' %}">
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.13.0/moment.min.js"></script>

  <div class="container">
    <div class="row"><h2 style="font-family:calibri; color:#3d3d5c; margin:20px auto">CSV statistics loaded in Ajax!</h2></div>
    <div class="row">
      <canvas style="display:block; margin: auto; max-width: 600px; max-height:600px" id="myChart" width="400" height="400"></canvas>
    </div>
    <div class="row">
      <canvas style="display:block; margin: auto; max-width: 600px; max-height:600px" id="myChart2" width="400" height="400"></canvas>
    </div>
  </div>
  <script type="text/javascript" src="http://code.jquery.com/jquery-1.10.0.min.js"></script>
  <script src="{% static '/chartjs/dist/Chart.js' %}"></script>
  <script type="text/javascript">
    var endpoint = '/stat-api/?format=json'
    $.ajax({
      method: "GET",
      url: endpoint,
      success: function(data){
        var labels = [];
        var hrData = [];
        var rrData = [];
        data.forEach(function(stat) {
          labels.push(stat.time);
          hrData.push(stat.hr);
          rrData.push(stat.rr);
        });
        var ctx = document.getElementById('myChart').getContext('2d');
        var myChart = new Chart (ctx, {
          type: 'line',
          data: {
            labels: labels,
            datasets: [{
              label: 'Heart Rate',
              data: hrData,
              borderColor: '#3e95cd',
              fill: false
            }, {
              label: 'Respiration Rate',
              data: rrData,
              borderColor: '#3cba9f',
              fill: false
            }]
          },
          options: {
            title: {
              display: true,
              text: 'HR and RR over time (s)'
            }
          }
        });
      },
      error: function(error_data) {
        console.log("error")
        console.log(error_data)
      }
    })
  </script>
  <script type="text/javascript">
    var endpoint2 = '/analysis-api/?format=json'
    $.ajax({
      method: "GET",
      url: endpoint2,
      success: function(data){
        var sessionDate = [];
        var avgHRdata = [];
        var avgRRdata = [];
        data.forEach(function(stat) {
          sessionDate.push(stat.sessionID.startDate);
          avgHRdata.push(stat.avgHR);
          avgRRdata.push(stat.avgRR);
        });
        var ctx2 = document.getElementById('myChart2').getContext('2d');
        var myChart2 = new Chart (ctx2, {
          type: 'line',
          data: {
            labels: sessionDate,
            datasets: [{
              label: 'Average Heart Rate',
              data: avgHRdata,
              borderColor: '#3e95cd',
              fill: false
            }, {
              label: 'Average Respiration Rate',
              data: avgRRdata,
              borderColor: '#3cba9f',
              fill: false
            }]
          },
          options: {
            title: {
              display: true,
              text: 'Average HR and RR over a week'
            }
          }
        });
      },
      error: function(error_data) {
        console.log("error")
        console.log(error_data)
      }
    })
  </script>
  
{% if queryset %}
  {% for statistic in queryset %}
    <p>{{statistic.sessionID.id}}</p>
  {% endfor %}
{% else %}
  <p>No stats are available.</p>
{% endif %}
