<!-- templates/polls/analysis.html -->
{% extends 'template.html' %}

{% block title %}WSM | Analysis{% endblock %}
{% block content %}

  <div class="container mt-20">
    {% if not user.is_authenticated %}
      <p>You are not logged in. Please log in to see this page.</p>
      <a href="{% url 'login' %}">login</a>
    {% else %}
      <p style="color:whitesmoke">Hi {{ user.username }}!</p>
      <p>
        <a href="{% url 'logout' %}">logout</a><br>
        <a href="" class="fill-btn" style="margin: 0; text-decoration: none;">See all</a>
      </p>

      <form method="post">
        {% csrf_token %}
        {{ form.as_p }}
        <input class="submit-row" type="submit" value="Submit">
      </form>

      <h2>{{date}}</h2>

      {%if analysis%}
        <div class="stats" style="display: flex">
            <ul id="timedata" style="font-size: 20px; color:#3d3d5c; font-family:calibri">
              {% for stat in analysis %}
                <h3><a href={{stat.sessionID.id}}>{{stat.sessionID.startDate}}, {{stat.sessionID.startTime}}</a></h3>
                <h4>Statistics</h4>
                <li>Total time: {{stat.tst.hour}} hours and {{stat.tst.minute}} minutes and {{stat.tst.second}} seconds</li>
                <li>Average HR: {{ stat.avgHR }}</li>
                <li>Average RR: {{ stat.avgRR }}</li>
                {%if stat.avgHRdip == -1%}
                  <li>Average HR Dip: Not enough data to calculate HR Dip. Please record a sleep session for longer than 1 minute</li>
                {%else%}
                  <li>Average HR Dip: {{ stat.avgHRdip }}</li>
                {%endif%}
                <li>Min HR: {{ stat.minHR }}</li>
                <li>Max HR: {{ stat.maxHR }}</li>
                <li>Min RR: {{ stat.minRR }}</li>
                <li>Max RR: {{ stat.avgRR }}</li>
                <h4>Sleep Notes</h4>
                {%if stat.sleepQuality == 0%}
                  <p>no sleep notes</p>
                {%else%}
                  <li>Sleep Quality: {{ stat.sleepQuality }}</li>
                  <li>Sleep Disruptions: {{ stat.sleepDisruptions }}</li>
                  <li>Sleep Notes: {{ stat.sleepNotes }}</li>
                  <li>Number of Sleep Disruptions: {{ stat.numSleepDisruptions }}</li>
                {%endif%}
              {% endfor %}

            </ul>
        </div>
      {%else%}
        <p>no statistics for this day</p>
      {%endif%}
    {% endif %}
  </div>

  {% endblock %}
